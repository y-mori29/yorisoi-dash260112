(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9582:function(e,t,s){Promise.resolve().then(s.bind(s,2872))},2872:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return B}});var a,r,l=s(3827),n=s(4090);(a=r||(r={})).LOGIN="LOGIN",a.FACILITY_LIST="FACILITY_LIST",a.PATIENT_LIST="PATIENT_LIST",a.RECORDING_CONFIRM="RECORDING_CONFIRM",a.RECORDING="RECORDING",a.RESULT="RESULT";let i=[{id:"1",name:"ケアホームはなこ",type:"介護付き有料老人ホーム"},{id:"2",name:"グループホームほしぞら",type:"グループホーム"},{id:"3",name:"特別養護老人ホームさくら",type:"特別養護老人ホーム"},{id:"4",name:"デイサービスあさひ",type:"通所介護"},{id:"5",name:"訪問看護ステーションみらい",type:"訪問看護"}],c=[{id:"p1",facilityId:"3",name:"山田 太郎",dob:"1945年4月1日",roomNumber:"101",status:"completed"},{id:"p2",facilityId:"3",name:"鈴木 一郎",dob:"1952年8月15日",roomNumber:"102",status:"incomplete"},{id:"p3",facilityId:"3",name:"佐藤 花子",dob:"1960年3月10日",roomNumber:"105",status:"completed"},{id:"p4",facilityId:"3",name:"高橋 健太",dob:"1948年11月25日",roomNumber:"201",status:"incomplete"},{id:"p5",facilityId:"1",name:"田中 美咲",dob:"1939年1月2日",roomNumber:"A-1",status:"incomplete"}],o="https://yorisoi-medical-677949259742.asia-northeast1.run.app",d="".concat(o,"/sign-upload"),x="".concat(o,"/finalize"),m=e=>"".concat(o,"/jobs/").concat(e),u=()=>{let[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)(!1),[r,l]=(0,n.useState)(""),i=(0,n.useRef)(null),c=(0,n.useRef)(""),o=(0,n.useRef)(0),u=(0,n.useRef)([]),h=(0,n.useRef)(0),p=(0,n.useCallback)(async()=>{let e=h.current+1;h.current=e,i.current&&("inactive"!==i.current.state&&i.current.stop(),i.current.stream.getTracks().forEach(e=>e.stop()),i.current=null),u.current=[];try{l("マイク準備中...");let s=await navigator.mediaDevices.getUserMedia({audio:!0});if(h.current!==e){s.getTracks().forEach(e=>e.stop());return}c.current=crypto.randomUUID(),o.current=0;let a="";for(let e of["audio/webm;codecs=opus","audio/webm","audio/mp4"])if(MediaRecorder.isTypeSupported(e)){a=e;break}a||(a="");let r=a?new MediaRecorder(s,{mimeType:a}):new MediaRecorder(s);r.ondataavailable=t=>{if(h.current===e&&t.data&&t.data.size>0){let e=y(t.data,c.current,a);u.current.push(e)}},i.current=r,r.start(1e4),t(!0),l("録音中..."),console.log("Started session: ".concat(c.current))}catch(t){if(h.current!==e)return;console.error("Mic error:",t),l("マイクエラー")}},[]),y=async(e,t,s)=>{o.current++;let a=o.current,r=e.type||s||"audio/webm";try{let s=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:t,userId:"demo-user",seq:a,contentType:r})});if(!s.ok)throw Error("署名URL取得エラー");let{signedUrl:l}=await s.json();if(!(await fetch(l,{method:"PUT",headers:{"Content-Type":r},body:e})).ok)throw Error("GCSアップロード失敗");console.log("Uploaded chunk #".concat(a))}catch(e){console.error("Upload error (seq=".concat(a,"):"),e)}},f=(0,n.useCallback)(async e=>{h.current+=1;let s=i.current;if(s&&"inactive"!==s.state){let e=new Promise(e=>{s.onstop=()=>e()});s.stop(),await e}return s&&s.stream.getTracks().forEach(e=>e.stop()),i.current=null,t(!1),l("データを保存中..."),u.current.length>0&&(await Promise.allSettled(u.current),u.current=[]),await j(c.current,e)},[]),b=(0,n.useCallback)(()=>{h.current+=1;let e=i.current;e&&("inactive"!==e.state&&e.stop(),e.stream.getTracks().forEach(e=>e.stop())),i.current=null,t(!1),a(!1),l(""),console.log("Recording cancelled.")},[]),j=async(e,t)=>{a(!0),l("AIが要約を作成中...");try{let s=await fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,userId:"demo-user",patientId:t.patientId,patientName:t.patientName,facilityId:t.facilityId,facilityName:t.facilityName})});if(!s.ok)throw Error("サーバーエラー");let a=await s.json();if(!a.ok)throw Error(a.error||"処理エラー");let r=a.jobId;return console.log("Finalize started. JobID: ".concat(r)),await g(r)}catch(e){console.error("Finalize/Polling error:",e),l("処理中にエラーが発生しました"),a(!1)}},g=async e=>{let t=0;return new Promise((s,r)=>{let n=setInterval(async()=>{t++;try{let i=await fetch(m(e));if(!i.ok)throw Error("Status check failed");let c=await i.json();console.log("Polling job ".concat(e,": ").concat(c.status)),"DONE"===c.status?(clearInterval(n),l("完了しました！"),a(!1),s(c.summary)):t>=30&&(clearInterval(n),l("タイムアウトしました"),a(!1),r(Error("Timeout")))}catch(e){console.error("Polling error",e),clearInterval(n),l("通信エラー"),a(!1),r(e)}},4e3)})};return{isRecording:e,isProcessing:s,statusText:r,startRecording:p,stopRecording:f,cancelRecording:b}};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var h={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),y=(e,t)=>{let s=(0,n.forwardRef)((s,a)=>{let{color:r="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:o="",children:d,...x}=s;return(0,n.createElement)("svg",{ref:a,...h,width:l,height:l,stroke:r,strokeWidth:c?24*Number(i)/Number(l):i,className:["lucide","lucide-".concat(p(e)),o].join(" "),...x},[...t.map(e=>{let[t,s]=e;return(0,n.createElement)(t,s)}),...Array.isArray(d)?d:[d]])});return s.displayName="".concat(e),s},f=y("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),b=y("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),j=y("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),g=y("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),N=y("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),v=y("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),w=y("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),k=y("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),I=y("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),T=y("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),S=y("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),C=y("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),z=y("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),M=y("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),E=y("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),R=y("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),_=y("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),L=y("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),O=y("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),A=e=>{let{title:t,showBack:s,onBack:a,showAdd:r,onAdd:n,className:i=""}=e;return(0,l.jsxs)("header",{className:"bg-surface h-14 flex items-center justify-between px-4 sticky top-0 z-10 shadow-sm border-b border-gray-100 ".concat(i),children:[(0,l.jsx)("div",{className:"flex items-center w-10",children:s&&(0,l.jsx)("button",{onClick:a,className:"p-1 text-text-main hover:bg-gray-100 rounded-full transition-colors",children:(0,l.jsx)(T,{size:24})})}),(0,l.jsx)("h1",{className:"text-lg font-bold text-text-main flex-1 text-center truncate",children:t}),(0,l.jsx)("div",{className:"flex items-center justify-end w-10",children:r&&(0,l.jsx)("button",{onClick:n,className:"text-primary hover:opacity-80 transition-opacity",children:(0,l.jsx)(v,{size:28,className:"fill-current"})})})]})},P=()=>(0,l.jsx)("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-6",children:(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-8",children:[(0,l.jsx)("div",{className:"w-24 h-24 rounded-full border-4 border-gray-200 border-t-primary animate-spin"}),(0,l.jsxs)("div",{className:"w-64 space-y-2 text-center",children:[(0,l.jsx)("p",{className:"text-text-main font-bold",children:"データを読み込み中..."}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5 overflow-hidden",children:(0,l.jsx)("div",{className:"bg-primary h-1.5 rounded-full w-1/2 animate-[pulse_1.5s_ease-in-out_infinite]"})})]})]})}),F=e=>{let{message:t,type:s,onClose:a}=e;return(0,n.useEffect)(()=>{let e=setTimeout(()=>{a()},3e3);return()=>clearTimeout(e)},[a]),(0,l.jsx)("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[60] animate-[slideUp_0.3s_ease-out]",children:(0,l.jsxs)("div",{className:"px-6 py-3 rounded-full shadow-lg flex items-center space-x-3 backdrop-blur-md ".concat("bg-gray-800/90 text-white"),children:["success"===s?(0,l.jsx)(M,{size:20,className:"text-green-400"}):(0,l.jsx)(z,{size:20,className:"text-gray-400"}),(0,l.jsx)("span",{className:"font-bold text-sm",children:t})]})})},D=e=>{let{onLogin:t}=e,[s,a]=(0,n.useState)(!1),[r,i]=(0,n.useState)(!1),[c,o]=(0,n.useState)(!1);return(0,l.jsx)("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-6",children:(0,l.jsxs)("div",{className:"w-full max-w-sm bg-surface/50 backdrop-blur-sm p-8 rounded-2xl shadow-none",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[(0,l.jsx)("div",{className:"w-20 h-20 bg-blue-200 rounded-2xl flex items-center justify-center mb-6 shadow-sm",children:(0,l.jsx)(f,{size:40,className:"text-primary",strokeWidth:2.5})}),(0,l.jsx)("h1",{className:"text-2xl font-bold text-text-main",children:"ログイン"})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-text-main",children:"ユーザーID"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,l.jsx)(b,{size:20,className:"text-gray-500"})}),(0,l.jsx)("input",{type:"text",placeholder:"IDを入力",disabled:r,className:"w-full pl-10 pr-4 py-3 bg-gray-200/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 text-text-main placeholder-gray-500 transition-all disabled:opacity-50"})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-text-main",children:"パスワード"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,l.jsx)(j,{size:20,className:"text-gray-500"})}),(0,l.jsx)("input",{type:s?"text":"password",placeholder:"パスワードを入力",disabled:r,className:"w-full pl-10 pr-10 py-3 bg-gray-200/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 text-text-main placeholder-gray-500 transition-all disabled:opacity-50"}),(0,l.jsx)("button",{onClick:()=>a(!s),disabled:r,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 disabled:opacity-50",children:s?(0,l.jsx)(N,{size:20}):(0,l.jsx)(g,{size:20})})]})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{id:"remember-me",type:"checkbox",checked:c,onChange:e=>o(e.target.checked),disabled:r,className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer accent-primary"}),(0,l.jsx)("label",{htmlFor:"remember-me",className:"ml-2 text-sm text-text-main cursor-pointer select-none",children:"ログイン情報を保存する"})]}),(0,l.jsx)("button",{onClick:()=>{i(!0),setTimeout(()=>{i(!1),t()},1500)},disabled:r,className:"w-full bg-primary hover:bg-primary-dark text-white font-bold py-3.5 rounded-xl shadow-lg shadow-blue-500/30 active:scale-[0.98] transition-all disabled:opacity-70 disabled:cursor-not-allowed flex justify-center items-center",children:r?"ログイン中・・・":"ログイン"}),(0,l.jsx)("div",{className:"text-center pt-2",children:(0,l.jsx)("a",{href:"#",className:"text-sm text-primary underline decoration-1 underline-offset-4 ".concat(r?"pointer-events-none opacity-50":""),children:"パスワードをお忘れの場合"})})]})]})})},U=e=>{let{onSelectFacility:t}=e,[s,a]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{let e=setTimeout(()=>{a(!1)},1500);return()=>clearTimeout(e)},[]),s)?(0,l.jsx)(P,{}):(0,l.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,l.jsx)(A,{title:"施設一覧",showAdd:!0}),(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsxs)("div",{className:"relative mb-6",children:[(0,l.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,l.jsx)(w,{size:18,className:"text-gray-400"})}),(0,l.jsx)("input",{type:"text",placeholder:"施設名で検索",className:"w-full pl-10 pr-4 py-3 bg-gray-200/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 text-sm"})]}),(0,l.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,l.jsxs)("div",{onClick:()=>t(e),className:"bg-surface p-4 rounded-xl shadow-sm border border-gray-100 flex items-center active:bg-gray-50 transition-colors cursor-pointer",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-blue-100/50 rounded-xl flex items-center justify-center mr-4 shrink-0",children:(0,l.jsx)(k,{size:24,className:"text-primary"})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("h3",{className:"font-bold text-text-main truncate",children:e.name}),(0,l.jsx)("p",{className:"text-xs text-text-sub truncate",children:e.type})]}),(0,l.jsx)(I,{size:20,className:"text-gray-400 ml-2"})]},e.id))})]})]})},G=e=>{let{facility:t,onBack:s,onSelectPatient:a}=e,[r,i]=(0,n.useState)(!0),[o,d]=(0,n.useState)("all");(0,n.useEffect)(()=>{let e=setTimeout(()=>{i(!1)},1500);return()=>clearTimeout(e)},[]);let x=c.filter(e=>(e.facilityId===t.id||"3"===e.facilityId)&&("all"===o||e.status===o));return r?(0,l.jsx)(P,{}):(0,l.jsxs)("div",{className:"min-h-screen bg-background relative pb-20",children:[(0,l.jsx)(A,{title:"患者一覧",showBack:!0,onBack:s}),(0,l.jsxs)("div",{className:"p-5",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-text-main mb-4",children:t.name}),(0,l.jsxs)("div",{className:"relative mb-4",children:[(0,l.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,l.jsx)(w,{size:18,className:"text-gray-400"})}),(0,l.jsx)("input",{type:"text",placeholder:"患者を検索",className:"w-full pl-10 pr-4 py-3 bg-gray-200/60 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 text-sm"})]}),(0,l.jsx)("div",{className:"flex bg-gray-200/50 p-1 rounded-xl mb-6",children:["all","completed","incomplete"].map(e=>(0,l.jsxs)("button",{onClick:()=>d(e),className:"flex-1 py-2 text-sm font-bold rounded-lg transition-all ".concat(o===e?"bg-surface text-primary shadow-sm":"text-gray-500 hover:text-gray-700"),children:["all"===e&&"全て","completed"===e&&"完了","incomplete"===e&&"未完了"]},e))}),(0,l.jsxs)("div",{className:"space-y-0 divide-y divide-gray-100 bg-surface rounded-xl overflow-hidden shadow-sm border border-gray-100",children:[x.map(e=>(0,l.jsxs)("div",{onClick:()=>a(e),className:"p-4 flex items-center active:bg-gray-50 transition-colors cursor-pointer",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mr-4 shrink-0 text-text-main",children:(0,l.jsx)(b,{size:20})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,l.jsx)("h3",{className:"font-bold text-text-main text-lg",children:e.name})}),(0,l.jsxs)("p",{className:"text-xs text-text-sub",children:["生年月日: ",e.dob]})]}),(0,l.jsx)("div",{className:"flex flex-col items-end space-y-2 ml-3",children:"completed"===e.status?(0,l.jsxs)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700",children:[(0,l.jsx)(M,{size:12,className:"mr-1"}),"完了"]}):(0,l.jsxs)("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-700",children:[(0,l.jsx)(E,{size:12,className:"mr-1"}),"未完了"]})}),(0,l.jsx)(I,{size:20,className:"text-gray-300 ml-2"})]},e.id)),0===x.length&&(0,l.jsx)("div",{className:"p-8 text-center text-gray-400 text-sm",children:"該当する患者はいません"})]})]})]})},q=e=>{let{patient:t,onCancel:s,onStart:a}=e;return(0,l.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col justify-end sm:justify-center items-center animate-[fadeIn_0.2s_ease-out]",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[2px]",onClick:s}),(0,l.jsxs)("div",{className:"relative w-full max-w-sm bg-background rounded-t-2xl sm:rounded-2xl p-6 pb-10 shadow-2xl animate-[slideUp_0.3s_ease-out]",children:[(0,l.jsx)("div",{className:"w-12 h-1 bg-gray-300 rounded-full mx-auto mb-8 sm:hidden"}),(0,l.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,l.jsx)("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mb-6 text-primary",children:(0,l.jsx)(S,{size:36,fill:"currentColor",className:"opacity-90"})}),(0,l.jsx)("h2",{className:"text-xl font-bold text-text-main mb-6",children:"録音を開始しますか？"}),(0,l.jsxs)("div",{className:"w-full bg-gray-200/50 rounded-xl p-4 mb-8 text-left",children:[(0,l.jsx)("p",{className:"text-xs text-text-sub mb-1",children:"対象者"}),(0,l.jsx)("p",{className:"text-lg font-bold text-text-main",children:t.name}),(0,l.jsxs)("p",{className:"text-sm text-text-sub mt-1",children:["ID: ",t.id.toUpperCase().replace("P","12345")," / Room ",t.roomNumber]})]}),(0,l.jsxs)("div",{className:"w-full space-y-3",children:[(0,l.jsx)("button",{onClick:a,className:"w-full bg-primary hover:bg-primary-dark text-white font-bold py-3.5 rounded-xl shadow-lg shadow-blue-500/20 active:scale-[0.98] transition-all",children:"録音開始"}),(0,l.jsx)("button",{onClick:s,className:"w-full bg-transparent hover:bg-gray-100 text-primary font-bold py-3.5 rounded-xl transition-colors",children:"キャンセル"})]})]})]})]})},H=e=>{let{patient:t,facility:s,onStop:a,onDiscard:r}=e,{isRecording:i,isProcessing:c,statusText:o,startRecording:d,stopRecording:x,cancelRecording:m}=u(),[h,p]=(0,n.useState)(0);(0,n.useEffect)(()=>(d(),()=>{m()}),[]),(0,n.useEffect)(()=>{let e;return i&&(e=window.setInterval(()=>{p(e=>e+1)},1e3)),()=>clearInterval(e)},[i]);let y=async()=>{await x({patientId:t.id,patientName:t.name,facilityId:s.id,facilityName:s.name}),a()},f=async()=>{m(),r()},b=Array.from({length:40});return(0,l.jsxs)("div",{className:"fixed inset-0 bg-[#0F172A] text-white flex flex-col z-50",children:[(0,l.jsxs)("header",{className:"h-14 flex items-center px-4 relative justify-center",children:[(0,l.jsx)("button",{onClick:f,disabled:c,className:"absolute left-4 p-2 transition-colors ".concat(c?"text-gray-600":"text-gray-400 hover:text-white"),children:(0,l.jsx)(T,{size:24})}),(0,l.jsx)("span",{className:"font-bold text-base",children:"録音"})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col items-center pt-10 px-6",children:[(0,l.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:"患者名"}),(0,l.jsxs)("h2",{className:"text-3xl font-bold mb-6",children:[t.name," 様"]}),(0,l.jsx)("div",{className:"flex items-center space-x-2 mb-10 h-6",children:c?(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-blue-400",children:[(0,l.jsx)(R,{size:16,className:"animate-spin"}),(0,l.jsx)("span",{className:"text-base font-bold animate-pulse",children:o})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(i?"bg-red-500 animate-pulse":"bg-gray-500")}),(0,l.jsx)("span",{className:"text-base font-medium ".concat(i?"text-red-500":"text-gray-400"),children:o||(i?"録音中":"準備中...")})]})}),(0,l.jsx)("div",{className:"text-6xl font-mono font-bold tracking-wider mb-20 tabular-nums",children:"".concat(Math.floor(h/3600).toString().padStart(2,"0")," : ").concat(Math.floor(h%3600/60).toString().padStart(2,"0")," : ").concat((h%60).toString().padStart(2,"0"))}),(0,l.jsx)("div",{className:"h-16 flex items-center justify-center space-x-[4px] w-full max-w-sm mb-auto",children:b.map((e,t)=>(0,l.jsx)("div",{className:"w-1 rounded-full transition-all duration-150 ease-in-out ".concat(t%2==0?"bg-blue-500":"bg-blue-400"),style:{height:i?"".concat(Math.max(8,64*Math.random()),"px"):"4px",opacity:i?.4+.6*Math.random():.2}},t))}),(0,l.jsxs)("div",{className:"w-full pb-12 flex flex-col items-center space-y-10",children:[(0,l.jsx)("button",{onClick:y,disabled:c||!i,className:"w-full max-w-sm font-bold py-4 rounded-xl flex items-center justify-center space-x-3 transition-colors active:scale-[0.98] ".concat(c||!i?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-primary hover:bg-primary-dark text-white shadow-lg shadow-blue-500/30"),children:c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R,{size:20,className:"animate-spin"}),(0,l.jsx)("span",{children:o})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C,{size:18,fill:"currentColor"}),(0,l.jsx)("span",{children:"停止して保存"})]})}),(0,l.jsxs)("button",{onClick:f,className:"text-sm flex items-center space-x-2 py-2 ".concat(c?"text-gray-600 cursor-not-allowed":"text-gray-400 hover:text-white"),disabled:c,children:[(0,l.jsx)(z,{size:16}),(0,l.jsx)("span",{children:"録音を破棄"})]})]})]})]})},V=e=>{var t,s,a,r;let{result:i,patient:c,onHome:o}=e,[d,x]=(0,n.useState)(!1);return(0,l.jsxs)("div",{className:"min-h-screen bg-background pb-12",children:[(0,l.jsx)(A,{title:"結果確認"}),(0,l.jsxs)("div",{className:"p-4 space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-primary",children:(0,l.jsx)(b,{size:20})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{className:"text-lg font-bold text-text-main",children:[c.name," 様"]}),(0,l.jsx)("p",{className:"text-xs text-text-sub",children:"録音完了"})]})]}),(0,l.jsxs)("div",{className:"bg-surface rounded-xl border-2 border-primary/20 overflow-hidden shadow-sm",children:[(0,l.jsxs)("div",{className:"bg-primary/5 px-4 py-2 border-b border-primary/10 flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-primary font-bold text-sm",children:[(0,l.jsx)(_,{size:16}),(0,l.jsx)("span",{children:"レセコン報告書用 (100文字)"})]}),(0,l.jsx)("button",{onClick:()=>{i.report_100&&navigator.clipboard.writeText(i.report_100).then(()=>{x(!0),setTimeout(()=>x(!1),2e3)})},className:"flex items-center space-x-1 px-3 py-1.5 rounded-lg text-xs font-bold transition-all ".concat(d?"bg-green-500 text-white":"bg-primary text-white hover:bg-primary-dark shadow-md active:scale-95"),children:d?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(O,{size:14}),(0,l.jsx)("span",{children:"コピー完了"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(L,{size:14}),(0,l.jsx)("span",{children:"コピー"})]})})]}),(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)("p",{className:"text-text-main text-base leading-relaxed whitespace-pre-wrap font-medium",children:i.report_100||"（要約なし）"})})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"font-bold text-text-main text-lg ml-1",children:"SOAP ドラフト"}),(0,l.jsx)("div",{className:"bg-surface rounded-xl border border-gray-100 shadow-sm overflow-hidden divide-y divide-gray-100",children:[{label:"S (主訴)",content:null===(t=i.soap)||void 0===t?void 0:t.s},{label:"O (客観)",content:null===(s=i.soap)||void 0===s?void 0:s.o},{label:"A (評価)",content:null===(a=i.soap)||void 0===a?void 0:a.a},{label:"P (計画)",content:null===(r=i.soap)||void 0===r?void 0:r.p}].map((e,t)=>(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("span",{className:"block text-xs font-bold text-primary mb-1.5",children:e.label}),(0,l.jsx)("p",{className:"text-sm text-text-main whitespace-pre-wrap leading-relaxed",children:e.content||"（記載なし）"})]},t))})]}),(0,l.jsx)("button",{onClick:o,className:"w-full bg-gray-200 hover:bg-gray-300 text-text-main font-bold py-3.5 rounded-xl transition-colors mt-4",children:"ホームへ戻る"})]})]})};function B(){let[e,t]=(0,n.useState)(r.LOGIN),[s,a]=(0,n.useState)(null),[i,c]=(0,n.useState)(null),[o,d]=(0,n.useState)(null),[x,m]=(0,n.useState)(null),u=(e,t)=>{m({message:e,type:t})},h=()=>{a(null),t(r.FACILITY_LIST)};return(0,l.jsxs)("div",{className:"font-sans text-text-main",children:[x&&(0,l.jsx)(F,{message:x.message,type:x.type,onClose:()=>m(null)}),e===r.LOGIN&&(0,l.jsx)(D,{onLogin:()=>{t(r.FACILITY_LIST)}}),e===r.FACILITY_LIST&&(0,l.jsx)(U,{onSelectFacility:e=>{a(e),t(r.PATIENT_LIST)}}),e===r.PATIENT_LIST&&s&&(0,l.jsx)(G,{facility:s,onBack:h,onSelectPatient:e=>{c(e),t(r.RECORDING_CONFIRM)}}),e===r.RECORDING_CONFIRM&&i&&s&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(G,{facility:s,onBack:h,onSelectPatient:()=>{}}),(0,l.jsx)(q,{patient:i,onCancel:()=>{t(r.PATIENT_LIST),setTimeout(()=>c(null),300)},onStart:()=>{t(r.RECORDING)}})]}),e===r.RECORDING&&i&&s&&(0,l.jsx)(H,{patient:i,facility:s,onStop:e=>{e?(d(e),t(r.RESULT),u("音声処理が完了しました","success")):(t(r.PATIENT_LIST),c(null),u("録音が保存されました（結果なし）","neutral"))},onDiscard:()=>{t(r.PATIENT_LIST),c(null),u("録音は破棄されました","neutral")}}),e===r.RESULT&&o&&i&&(0,l.jsx)(V,{result:o,patient:i,onHome:()=>{d(null),c(null),t(r.PATIENT_LIST)}})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=9582)}),_N_E=e.O()}]);